services:
  identityserver-api:
    build:
      context: .
      dockerfile: IdentityServer.Api/Dockerfile
      target: build
    container_name: identityserver-api-dev
    ports:
      - "7000:8080"
      - "7001:8081"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:8080
      - ConnectionStrings__DefaultConnection=InMemory
      - JWT__SecretKey=MyVerySecretKeyForJWTTokenGeneration123456789
      - Cors__AllowedOrigins__0=https://localhost:5173
      - Cors__AllowedOrigins__1=http://localhost:5173
      - Authentication__Google__ClientId=${GOOGLE_CLIENT_ID}
      - Authentication__Google__ClientSecret=${GOOGLE_CLIENT_SECRET}
    volumes:
      - ./IdentityServer.Api:/src/IdentityServer.Api:ro
      - ./IdentityServer.Core:/src/IdentityServer.Core:ro
    networks:
      - identity-network-dev
    restart: unless-stopped
    command: ["dotnet", "watch", "run", "--project", "/src/IdentityServer.Api/IdentityServer.Api.csproj", "--urls", "http://+:8080"]

networks:
  identity-network-dev:
    driver: bridge
